server {
    # Escucha en el puerto 80 (dentro del contenedor)
    listen 80;

    # Directorio raíz donde Nginx buscará los archivos
    # Coincide con el 'COPY --from=build /app/dist /usr/share/nginx/html' de tu Dockerfile
    root /usr/share/nginx/html;

    # Archivo de índice por defecto
    index index.html;

    # --- LA SOLUCIÓN AL ERROR 404 ---
    # Esta es la configuración clave para una Single Page Application (SPA)
    location / {
        # 1. Intenta servir el archivo exacto (ej. /assets/app.js)
        # 2. Intenta servir el directorio (menos común para Vue)
        # 3. Si ambos fallan (ej. /lobby, /sala/XYZ)...
        #    ...sirve /index.html.
        # Vue Router tomará el control desde allí.
        try_files $uri $uri/ /index.html;
    }

  
  # Proxy API requests to the backend server service
    ---location /api/ {
        proxy_pass http://server:7001/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    #
    # Opcional: Configuración para cachear assets estáticos (JS, CSS, imágenes)
    # Esto le dice al navegador que guarde estos archivos por mucho tiempo,
    # ya que tienen un hash único en el nombre (ej. index-acevwDve.js)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public";
    }
}